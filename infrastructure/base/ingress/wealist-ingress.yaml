# =============================================================================
# Wealist 통합 Ingress
# =============================================================================
# 모든 서비스의 라우팅을 한 곳에서 관리
# 
# 경로 구조:
#   /                    -> frontend (React SPA)
#   /oauth2/*            -> auth-service (OAuth2 시작)
#   /login/oauth2/*      -> auth-service (OAuth2 콜백)
#   /api/auth/*          -> auth-service (인증 API)
#   /api/users/*         -> user-service
#   /api/workspaces/*    -> user-service
#   /api/profiles/*      -> user-service
#   /api/internal/*      -> user-service (서비스간 통신)
#   /api/boards/*        -> board-service
#   /api/chat/*          -> chat-service
#   /api/notifications/* -> noti-service
#   /api/storage/*       -> storage-service
# =============================================================================

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: wealist-ingress
  namespace: wealist-app
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths:
          # ============================================
          # Frontend (React SPA) - 기본 경로
          # ============================================
          - path: /
            pathType: Prefix
            backend:
              service:
                name: frontend
                port:
                  number: 80

          # ============================================
          # Auth Service - OAuth2 & 인증
          # ============================================
          - path: /oauth2
            pathType: Prefix
            backend:
              service:
                name: auth-service
                port:
                  number: 8081
          - path: /login/oauth2
            pathType: Prefix
            backend:
              service:
                name: auth-service
                port:
                  number: 8081
          - path: /api/auth
            pathType: Prefix
            backend:
              service:
                name: auth-service
                port:
                  number: 8081

          # ============================================
          # User Service - 사용자 & 워크스페이스
          # ============================================
          - path: /api/users
            pathType: Prefix
            backend:
              service:
                name: user-service
                port:
                  number: 8080
          - path: /api/workspaces
            pathType: Prefix
            backend:
              service:
                name: user-service
                port:
                  number: 8080
          - path: /api/profiles
            pathType: Prefix
            backend:
              service:
                name: user-service
                port:
                  number: 8080
          - path: /api/internal
            pathType: Prefix
            backend:
              service:
                name: user-service
                port:
                  number: 8080

          # ============================================
          # Board Service - 보드 & 카드
          # ============================================
          - path: /api/boards
            pathType: Prefix
            backend:
              service:
                name: board-service
                port:
                  number: 8000

          # ============================================
          # Chat Service - 채팅
          # ============================================
          - path: /api/chat
            pathType: Prefix
            backend:
              service:
                name: chat-service
                port:
                  number: 8082

          # ============================================
          # Notification Service - 알림
          # ============================================
          - path: /api/notifications
            pathType: Prefix
            backend:
              service:
                name: noti-service
                port:
                  number: 8083

          # ============================================
          # Storage Service - 파일 저장
          # ============================================
          - path: /api/storage
            pathType: Prefix
            backend:
              service:
                name: storage-service
                port:
                  number: 8084
