# Kind cluster configuration with Ingress support
# nginx-ingress를 통해 모든 서비스에 접근
#
# 사용법:
#   1. kind create cluster --config infrastructure/kind/kind-config.yaml
#   2. make ingress-install  # nginx-ingress 설치
#   3. make k8s-apply-local  # 서비스 배포
#
# 접근 (SSH 터널링: ssh -L 8080:localhost:80 ...):
#   - http://localhost:8080       -> frontend (React)
#   - http://localhost:8080/oauth2 -> auth-service (OAuth2)
#   - http://localhost:8080/api/users -> user-service
#   - http://localhost:8080/api/boards -> board-service
#
# Google OAuth redirect URI (콘솔에 추가 필요):
#   - http://localhost:8080/login/oauth2/code/google
#
# 노드 구성: 1 control-plane + 3 workers (기본값)
# 변경하려면 아래 nodes 섹션 수정

kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
name: wealist-project
nodes:
  # Control Plane (Master) - Ingress는 여기서만 동작
  - role: control-plane
    extraPortMappings:
      # Ingress HTTP (SSH 터널링으로 8080:80 매핑)
      - containerPort: 80
        hostPort: 80
        protocol: TCP
      # Ingress HTTPS
      - containerPort: 443
        hostPort: 443
        protocol: TCP
    kubeadmConfigPatches:
      - |
        kind: InitConfiguration
        nodeRegistration:
          kubeletExtraArgs:
            node-labels: "ingress-ready=true"
  # Worker Node 1
  - role: worker
  # Worker Node 2
  - role: worker
  # Worker Node 3
  - role: worker
