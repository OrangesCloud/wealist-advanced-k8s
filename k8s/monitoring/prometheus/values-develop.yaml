# =============================================================================
# kube-prometheus-stack Helm Values (develop/Kind environment)
# =============================================================================
# Chart: https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack
#
# Install:
#   helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
#   helm install prometheus prometheus-community/kube-prometheus-stack \
#     -n monitoring --create-namespace \
#     -f values-develop.yaml

# =============================================================================
# Global Settings
# =============================================================================
fullnameOverride: "prometheus"
namespaceOverride: "monitoring"

# =============================================================================
# Prometheus
# =============================================================================
prometheus:
  prometheusSpec:
    # Resource limits for Kind (lightweight)
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 500m

    # Retention
    retention: 7d
    retentionSize: "5GB"

    # Storage (for Kind, use emptyDir or small PVC)
    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 5Gi

    # Service discovery - monitor all namespaces
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false

    # Additional scrape configs for wealist services
    additionalScrapeConfigs:
      # Auth Service (Spring Boot Actuator)
      - job_name: 'auth-service'
        kubernetes_sd_configs:
          - role: endpoints
            namespaces:
              names:
                - wealist
                - wealist-dev
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            regex: auth-service
            action: keep
          - source_labels: [__meta_kubernetes_endpoint_port_name]
            regex: http
            action: keep
        metrics_path: '/actuator/prometheus'

  # Prometheus Service
  service:
    type: NodePort
    nodePort: 30090

# =============================================================================
# Grafana
# =============================================================================
grafana:
  enabled: true

  # Admin credentials
  adminUser: admin
  adminPassword: wealist-admin

  # Resource limits
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 200m

  # Service
  service:
    type: NodePort
    nodePort: 30030

  # Persistence
  persistence:
    enabled: true
    size: 1Gi

  # Default dashboards
  defaultDashboardsEnabled: true
  defaultDashboardsTimezone: Asia/Seoul

  # Additional datasources (Loki will be added separately)
  additionalDataSources:
    - name: Loki
      type: loki
      url: http://loki:3100
      access: proxy
      isDefault: false

  # Grafana.ini configuration
  grafana.ini:
    server:
      root_url: "%(protocol)s://%(domain)s:%(http_port)s/grafana"
      serve_from_sub_path: false
    auth.anonymous:
      enabled: true
      org_role: Viewer
    users:
      viewers_can_edit: true

# =============================================================================
# Alertmanager
# =============================================================================
alertmanager:
  enabled: true
  alertmanagerSpec:
    resources:
      requests:
        memory: 64Mi
        cpu: 10m
      limits:
        memory: 128Mi
        cpu: 100m
    storage:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 1Gi
  service:
    type: NodePort
    nodePort: 30093

# =============================================================================
# Node Exporter (optional for Kind)
# =============================================================================
nodeExporter:
  enabled: true
  resources:
    requests:
      memory: 32Mi
      cpu: 10m
    limits:
      memory: 64Mi
      cpu: 100m

# =============================================================================
# Kube State Metrics
# =============================================================================
kubeStateMetrics:
  enabled: true

# =============================================================================
# Prometheus Operator
# =============================================================================
prometheusOperator:
  resources:
    requests:
      memory: 64Mi
      cpu: 50m
    limits:
      memory: 128Mi
      cpu: 200m

# =============================================================================
# Disable unnecessary components for local Kind
# =============================================================================
kubeControllerManager:
  enabled: false
kubeScheduler:
  enabled: false
kubeProxy:
  enabled: false
kubeEtcd:
  enabled: false
