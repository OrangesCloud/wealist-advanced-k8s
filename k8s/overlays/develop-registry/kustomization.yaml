# =============================================================================
# Kustomization - Develop Environment (Kind + Local Registry)
# =============================================================================
# 적용: kubectl apply -k k8s/overlays/develop-registry
#
# 이 overlay는 로컬 레지스트리(localhost:5001)를 사용하는 Kind 클러스터용입니다.
# Docker Hub rate limit을 우회할 때 사용합니다.
#
# 사용법:
#   make kind-setup           # 클러스터 + 레지스트리 생성
#   make k8s-deploy-registry  # 빌드 + 푸시 + 배포

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: wealist-dev

resources:
  - ../../base/namespace-dev
  - ../../base/shared
  - ../develop/ingress.yaml

labels:
  - pairs:
      app.kubernetes.io/env: develop
      app.kubernetes.io/registry: local
    includeSelectors: false

patches:
  - target:
      kind: ConfigMap
      name: wealist-shared-config
    patch: |-
      - op: replace
        path: /data/ENV
        value: "develop"
      - op: replace
        path: /data/LOG_LEVEL
        value: "debug"
